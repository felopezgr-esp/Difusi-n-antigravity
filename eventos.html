<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Difusión - Listado de Eventos</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom Style -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Table specifics not general enough for styles.css yet */
        .table-view-container {
            margin-top: 1rem;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <header class="main-header glass-panel">
            <div class="logo-area">
                <h1>Difusión</h1>
                <p>Gestión de Eventos y Exposiciones</p>
            </div>
            <div class="actions">
                <button id="themeToggle" class="icon-btn" title="Cambiar tema">
                    <i data-lucide="moon"></i>
                </button>
                <a href="index.html" class="btn secondary">
                    <i data-lucide="calendar"></i> CALENDARIO
                </a>
                <button id="templateBtn" class="btn secondary" title="Descargar plantilla de exemplo">
                    <i data-lucide="file-spreadsheet"></i>
                </button>
                <button id="importBtn" class="btn secondary" title="Importar eventos desde Excel">
                    <i data-lucide="upload"></i>
                </button>
                <input type="file" id="importFile" accept=".xlsx, .xls" style="display: none;">
                <button id="exportBtn" class="btn secondary" title="Exportar a Excel">
                    <i data-lucide="download"></i>
                </button>
                <button id="addEventBtn" class="btn primary">
                    <i data-lucide="plus"></i> Novo
                </button>
            </div>
        </header>

        <section class="stats-bar glass-panel">
            <div class="stat-item clickable" id="statBtnTotal">
                <span class="stat-value" id="statTotal">0</span>
                <span class="stat-label">Eventos</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item clickable" id="statBtnMonth">
                <span class="stat-value" id="statMonth">0</span>
                <span class="stat-label">Este Mes</span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item clickable" id="statBtnPending">
                <span class="stat-value" id="statPending">0</span>
                <span class="stat-label">Pendientes</span>
            </div>
        </section>

        <div class="sidebar-map-layout">
            <aside class="content-sidebar">
                <section id="alertsContainer" class="alerts-container compact-view">
                    <div class="alerts-header">
                        <i data-lucide="bell-ring"></i> Tareas pendentes
                    </div>
                    <div id="alertsList"></div>
                </section>

                <section id="undatedEventsContainer" class="undated-container glass-panel">
                    <div class="undated-header">
                        <i data-lucide="calendar-off"></i> Evento sen data
                    </div>
                    <div id="undatedEventsList" class="undated-list vertical">
                        <!-- Javascript will populate this -->
                    </div>
                </section>
            </aside>

            <div class="map-section main-area">
                <div id="map"></div>
            </div>

            <aside class="filters-sidebar-compact glass-panel">
                <div class="filter-group">
                    <label>Evento</label>
                    <input type="text" id="searchInput" placeholder="Nome...">
                </div>
                <div class="filter-group">
                    <label>Mes</label>
                    <input type="text" id="monthFilter" placeholder="Mes" list="monthSuggestions">
                </div>
                <div class="filter-group">
                    <label>Ano</label>
                    <input type="number" id="yearFilter" placeholder="Ano" value="2026">
                </div>
                <div class="filter-group">
                    <label>Zoom</label>
                    <input type="number" id="mapZoomInput" value="7.5" step="0.1">
                </div>
                <div class="filter-group">
                    <label>Provincia</label>
                    <select id="provinceFilter">
                        <option value="">Todas</option>
                        <option value="A Coruña">A Coruña</option>
                        <option value="Lugo">Lugo</option>
                        <option value="Ourense">Ourense</option>
                        <option value="Pontevedra">Pontevedra</option>
                    </select>
                </div>
                <div class="filter-actions-compact">
                    <button id="searchBtn" class="icon-btn-primary"><i data-lucide="search"></i></button>
                    <button id="resetFiltersBtn" class="icon-btn-secondary"><i data-lucide="rotate-ccw"></i></button>
                </div>
                <datalist id="monthSuggestions"></datalist>
            </aside>
        </div>

        <main class="page-content glass-panel">
            <div class="table-container">
                <table class="events-table">
                    <thead>
                        <tr>
                            <th id="sortDate" style="cursor: pointer;">Data <i data-lucide="arrow-up-down"></i></th>
                            <th id="sortTitle" style="cursor: pointer;">Evento <i data-lucide="arrow-up-down"></i></th>
                            <th id="sortLoc" style="cursor: pointer;">Concello <i data-lucide="arrow-up-down"></i>
                            </th>
                            <th id="sortProvince" style="cursor: pointer;">Provincia <i data-lucide="arrow-up-down"></i>
                            </th>
                            <th>Horario</th>
                            <th>Estado</th>
                            <th>Accións</th>
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modals are shared between pages visually, but need to be present or injected -->
    <!-- Modal: Add Event -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="addEventForm">
                <div class="form-group">
                    <label>Nombre del Evento</label>
                    <input type="text" name="title" required placeholder="Ej: Feria de Arte">
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Fecha Inicio (Opcional)</label>
                        <input type="date" name="start">
                    </div>
                    <div class="form-group">
                        <label>Fecha Fin (Opcional)</label>
                        <input type="date" name="end">
                    </div>
                </div>
                <div class="form-group">
                    <label>Horario</label>
                    <input type="text" name="schedule" placeholder="10:00 - 18:00">
                </div>
                <div class="form-group">
                    <label>Concello / Ayuntamiento</label>
                    <select id="locationSelect" name="municipality">
                        <option value="">-- Selecciona un Concello --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dirección Exacta / Sala / Local</label>
                    <input type="text" id="locationInput" name="location" placeholder="Calle, nº, pabellón..."
                        autocomplete="off">
                    <input type="hidden" id="latInput" name="lat">
                    <input type="hidden" id="lngInput" name="lng">
                    <input type="hidden" id="provinceInput" name="province">
                </div>
                <div class="form-group">
                    <label>Detalles / Notas</label>
                    <textarea name="details" placeholder="Notas adicionales..." style="min-height: 80px;"></textarea>
                </div>
                <button type="submit" class="btn primary full-width">Guardar Evento</button>
            </form>
        </div>
    </div>

    <!-- Modal: Edit Event -->
    <div id="editEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="editEventForm">
                <input type="hidden" name="id" id="editEventId">
                <div class="form-group">
                    <label>Nombre del Evento</label>
                    <input type="text" name="title" id="editTitle" required>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Fecha Inicio (Opcional)</label>
                        <input type="date" name="start" id="editStart">
                    </div>
                    <div class="form-group">
                        <label>Fecha Fin (Opcional)</label>
                        <input type="date" name="end" id="editEnd">
                    </div>
                </div>
                <div class="form-group">
                    <label>Horario</label>
                    <input type="text" name="schedule" id="editSchedule">
                </div>
                <div class="form-group">
                    <label>Concello / Ayuntamiento</label>
                    <select id="editLocationSelect" name="municipality">
                        <option value="">-- Selecciona un Concello --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dirección Exacta / Sala / Local</label>
                    <input type="text" id="editLocationInput" name="location" autocomplete="off">
                    <input type="hidden" id="editLatInput" name="lat">
                    <input type="hidden" id="editLngInput" name="lng">
                    <input type="hidden" id="editProvinceInput" name="province">
                </div>
                <div class="form-group">
                    <label>Detalles / Notas</label>
                    <textarea name="details" id="editDetails" style="min-height: 80px;"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button type="submit" class="btn primary" style="flex: 1;">Actualizar</button>
                    <button type="button" id="deleteEventBtn" class="btn secondary"
                        style="color: #ef4444; border-color: #fee2e2; background: #fff1f2;">Eliminar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Event Details -->
    <div id="eventDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detailTitle">Título del Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <div class="event-info">
                <p><i data-lucide="calendar"></i> <span id="detailDates"></span></p>
                <p><i data-lucide="clock"></i> <span id="detailSchedule"></span></p>
                <p><i data-lucide="map-pin"></i> <span id="detailLocation"></span></p>
            </div>

            <div class="checklist-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="margin: 0;">Tareas y Estado</h4>
                    <button id="editEventBtn_FromDetails" class="btn secondary btn-small"><i
                            data-lucide="edit-3"></i></button>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-info">
                        <span>Progreso</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="checklistProgress" class="progress-fill"></div>
                    </div>
                </div>
                <ul id="checklistItems" class="checklist">
                    <!-- Javascript will populate this -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Modal: Filtered View from Stats -->
    <div id="filteredViewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="filteredViewTitle">Lista de Eventos</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <div id="filteredEventsList" class="filtered-list">
                <!-- Javascript will populate this -->
            </div>
        </div>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <script src="locations_data.js"></script>
    <script src="script.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>